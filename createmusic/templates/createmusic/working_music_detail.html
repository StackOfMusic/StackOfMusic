{% extends 'StackOfMusic/base.html' %}
<!doctype html>
<html lang="ko">
<head>
    {% block extra_scripts %}
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
        <script type="text/javascript">
            $(function () {
                $('#upload-btn').click(function () {
                    {#var file = $('#file-upload-form').serialize();#}
                    var form = $('#file-upload-form')[0];
                    var formData = new FormData(form);

                    console.log(formData);

                    $.ajax({
                        url: 'http://stackofmusic.s3.amazonaws.com/',
                        method: 'PUT',
                        contentType: false,
                        processData: false,
                        data: {
                            formData,
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                        },
                        success : function (data) {
                            alert('data');
                        },
                        error: function (error) {
                            alert('error');
                        }
                    })
                })
            })
        </script>

    {% endblock %}
</head>

<body>
{% block content %}

    <script type="text/javascript">

        $(function () {
            var working_music = {};
            $.ajax({
                method : 'GET',
                url : 'http://localhost:8000/create/list/WorkingMusicRetrieveAPI/{{ working_music_id }}',
                success: function (data) {
                    working_music = data;
                    console.log(working_music);
                },
                error: function (error) {
                    console.log(error);
                },
                xhrFields: {withCredentials: true,}
            });
        })

    </script>

    <script type="text/javascript">

        var working_music = {};
        $(function () {
            $.ajax({
                method: 'GET',
                url: 'http://localhost:8000/create/list/WorkingMusicRetrieveAPI/{{ working_music_id }}',
                success: function (data) {
                    working_music = data;
                    console.log(working_music);
                    var titleContainer = document.getElementById("mytitle");
                    var title = document.getElementById("mytitle2");
                    var ownerContainer = document.getElementById("myowner");
                    var dateContainer = document.getElementById("mydate");
                    var genreContainer = document.getElementById("mygenre");


                    title.append(working_music['title']);
                    dateContainer.append(working_music['create_date']);
                    titleContainer.append(working_music['title']);
                    ownerContainer.append(working_music['owner'].username);
                    genreContainer.append(working_music['genre'].name);

                    $('#image').attr("src", working_music['album_jacket']);
                    $('#music_image').attr("src", working_music['album_jacket']);
                    $('#music').attr("src", working_music['seed_file']);

                    $("#music2").attr("src", working_music['seed_file']);



                },
                error: function (error) {
                    alert(error + 'data를 불러올수없습니다.');
                },
                xhrFields: {withCredentials: true,}
            })
        });
        function play() {
            var firstmusic = document.getElementById("check");
            var secondmusic = document.getElementById("check2");

            if($(firstmusic).prop("checked")==true){
                var first = $("#music2").attr('src')
            }
            if($(secondmusic).prop("checked")==true){
                var second = $("#music3").children().attr('src')
            }
            var audio = new Audio(first);
            audio.play();
            var audio2 = new Audio(second);
            audio2.play();
        }

        $(function () {
            $('#working_music_img').attr("src", working_music['album_jacket']);
        });


    </script>




    <img id="working_music_img" src="" alt="">
    <div class="container">
        <div class="row well">
            <div class="col-md-12">
                <div class="panel">
                    <img id="music_image" src="" alt="" style="height:250px;width: 250px;float: left">
                    <div class="row user-left-part">
                        <div class="col-md-9 col-sm-9 col-xs-12 pull-right profile-right-section" style="height: 500px;">
                            <div class="row profile-right-section-row">
                                <div class="col-md-12 profile-header">
                                    <div class="row">
                                        <div class="col-md-8 col-sm-6 col-xs-6 profile-header-section1 pull-left">
                                            <h1><div id="mytitle" style="float: left;"></div></h1>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <!-- Tab panes -->
                                            <div class="tab-content">
                                                <div role="tabpanel" class="tab-pane fade show active" id="profile">
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <label>genre</label>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <h4><div id="mygenre" style="float: left;margin-left: 20px;"></div></h4>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <label>Owner</label>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <h4><div id="myowner" style="float: left;margin-left: 20px;"></div></h4>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-4">
                                                            <label>발매날짜</label>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div id="mydate" style="float: left;margin-left: 20px;"></div>
                                                        </div>
                                                    </div>
                                                    <audio id="music" controls style="margin-top:20px;margin-left: 10px;">
                                                        <source id="audio-source" src="" type="audio/mp4"/>
                                                    </audio>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <form enctype="multipart/form-data" id="file-upload-form" method="post">
                                    {% csrf_token %}
                                    <input type="file" name="music_file" id="ajaxFile">
                                    <input type="hidden" name="music_id" value="{{ object.pk }}">
                                    <input type="button" class="btn btn-primary" id='upload-btn' value="업로드"/>
                                </form>
                                {#                                <div class="container">#}
                                {#                                    <div class="post-comments">#}
                                {#                                        <form>#}
                                {#                                            <div class="form-group">#}
                                {#                                                <label for="comment">Your Comment</label>#}
                                {#                                                <textarea name="comment" class="form-control" rows="3"></textarea>#}
                                {#                                            </div>#}
                                {#                                            <button type="submit" class="btn btn-default">Send</button>#}
                                {#                                        </form>#}
                                {#                                    </div>#}
                                <!-- post-comments -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        $(function () {
            $('.btn-radio').siblings('.img-radio').css('opacity', '0.5');
            $('.btn-radio').click(function(e) {
                if ($(this).siblings('input').prop("checked")==true) {
                    $(this).removeClass('active')
                        .siblings('input').prop('checked', false)
                        .siblings('.img-radio').css('opacity', '0.5');
                }
                else if ($(this).siblings('input').prop("checked")==false) {
                    $(this).addClass('active')
                        .siblings('input').prop('checked', true)
                        .siblings('.img-radio').css('opacity', '1');
                }
            });
        });
    </script>
    <div class="col-xs-4" style="float: left">
        <img src="" style="width: 200px;margin-left: 100px;" id="image" class="img-responsive img-radio">
        <button type="button" class="btn btn-primary btn-radio" style="width: 100px;" id="mytitle2"></button>
        <input type="checkbox" id="check" class="hidden" style="display: none" >
        <audio id="music2" controls style="margin-top:20px;margin-left: 10px;">
            <source id="audio-source" src="" type="audio/mp3"/>
        </audio>
    </div>
    <div class="col-xs-4" style="float: left">
        <img src="../../../static/img/artist7.png" style="width: 200px;margin-left: 100px;" id="image2" class="img-responsive img-radio">
        <button type="button" class="btn btn-primary btn-radio" style="width: 100px;" id="mytitle3">Drum</button>
        <input type="checkbox" id="check2" class="hidden" style="display: none" >
        <audio id="music3" controls style="margin-top:20px;margin-left: 10px;">
            <source id="audio-source" src="../../../media/audiofile/rockdrum.mp3" type="audio/mp4"/>
        </audio>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-12 col-md-offset-3">
                <form class="form-horizontal well" role="form">
                    <div class="row">
                        {% for music in working_music %}
                            <div class="col-xs-4" style="float: left">
                                <img src="{{ music.album_jacket.url }}" style="width: 200px;margin-left: 100px;" class="img-responsive img-radio">
                                <button type="button" class="btn btn-primary btn-radio" style="width: 100px;">{{ music.title }}</button>
                                <input type="checkbox" id="{{ music.id }}" class="hidden" style="display: none" >
                            </div>
                        {% endfor %}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">

    </script>
    <audio controls="controls">
        <source src="" type="audio/mp4" />
        <source src="" type="audio/mp4" />
    </audio>
    <button type="button" onclick="play()" class="btn-dark" style="width: 100px;height: 50px;">Play</button>
    <a href="{% url 'create_music:working_music_delete' working_music_id %}">지워버리기~</a>
    <br>
    <a href="{% url 'create_music:sub_music_create' working_music_id %}">Contribution</a>





{% endblock %}
</body>
</html>